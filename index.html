<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>С Новым Годом ❄️</title>
<link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@700&display=swap" rel="stylesheet">
<style>
html,body{margin:0;padding:0;width:100%;height:100%;overflow:hidden;cursor:crosshair;}
canvas{display:block;}
#header {
  position:absolute; top:20px; width:100%; text-align:center;
  font-weight:900; font-family:'Mountains of Christmas', cursive;
  background:linear-gradient(90deg,#ff0000,#ff4d4d,#ff1a1a,#ff6666);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  text-shadow:0 0 10px #ff0000,0 0 20px #ff4d4d,0 0 30px #ff9999,0 0 40px #ff1a1a;
  pointer-events:none; animation:shimmer 2.5s infinite alternate,pulse 2s infinite ease-in-out;
}
@keyframes shimmer{0%{background-position:0% 50%;}100%{background-position:100% 50%;}}
@keyframes pulse{0%{transform: scale(1);}50%{transform: scale(1.05);}100%{transform: scale(1);}}
.phrase{position:absolute;font-weight:900;pointer-events:none;opacity:0;animation:fadeText 4s ease-in-out forwards;text-shadow:0 0 20px currentColor,0 0 50px currentColor;}
@keyframes fadeText{0%{opacity:0;transform:scale(.6)}30%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(1.6)}}
</style>
</head>
<body>
<div id="header">С Новым Годом</div>
<canvas id="canvas"></canvas>
<script>
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');

let width = canvas.width = window.innerWidth;
let height = canvas.height = window.innerHeight;

// Подстраиваем шапку под ширину экрана
function updateHeader(){
  const header = document.getElementById('header');
  let size = Math.min(width/6,72);
  header.style.fontSize = size + 'px';
}
updateHeader();

// Подстройка canvas и шапки при изменении ориентации или размера
function resizeCanvas(){
  width = canvas.width = window.innerWidth;
  height = canvas.height = window.innerHeight;
  updateHeader();
}
window.addEventListener('resize', resizeCanvas);
window.addEventListener('orientationchange', resizeCanvas);

/* ===== ЗВЁЗДЫ ===== */
const stars=[...Array(260)].map(()=>({x:Math.random()*width,y:Math.random()*height,r:Math.random()*1.6+0.3,t:Math.random()*6,s:Math.random()*0.01+0.003}));
function drawStars(){for(const s of stars){s.t+=s.s;const a=.25+Math.sin(s.t)*0.45;ctx.fillStyle=`rgba(255,255,255,${a})`;ctx.beginPath();ctx.arc(s.x,s.y,s.r,0,Math.PI*2);ctx.fill();}}

/* ===== СНЕЖИНКИ ===== */
class Snowflake{
  constructor(){this.x=Math.random()*width;this.y=Math.random()*height;this.size=Math.random()*6+2;this.vy=Math.random()*1+0.5;this.vx=Math.random()*0.6-0.3;this.angle=Math.random()*Math.PI*2;this.rotationSpeed=(Math.random()-0.5)*0.03;this.alpha=Math.random()*0.8+0.2;}
  update(){this.y+=this.vy;this.x+=this.vx+Math.sin(this.angle)*0.5;this.angle+=this.rotationSpeed;if(this.y>height)this.y=-this.size;if(this.x>width)this.x=0;if(this.x<0)this.x=width;}
  draw(){ctx.save();ctx.translate(this.x,this.y);ctx.rotate(this.angle);ctx.strokeStyle=`rgba(255,255,255,${this.alpha})`;ctx.lineWidth=1.2;ctx.beginPath();for(let i=0;i<6;i++){ctx.moveTo(0,0);ctx.lineTo(0,this.size);ctx.rotate(Math.PI/3);}ctx.stroke();ctx.restore();}
}
const snowflakes=[...Array(120)].map(()=>new Snowflake());
function drawSnow(){snowflakes.forEach(s=>{s.update();s.draw();});}

/* ===== ЗВУКИ ===== */
const sounds=[
  new Audio('https://cdn.jsdelivr.net/gh/joshua19881228/fireworks-sound/firework1.mp3'),
  new Audio('https://cdn.jsdelivr.net/gh/joshua19881228/fireworks-sound/firework2.mp3'),
  new Audio('https://cdn.jsdelivr.net/gh/joshua19881228/fireworks-sound/firework3.mp3')
];
function playSound(){const a=sounds[Math.floor(Math.random()*sounds.length)].cloneNode();a.volume=.45;a.play();}

/* ===== САЛЮТ ===== */
const rays=[],sparks=[],embers=[];
class Ray{
  constructor(x,y,a,s,c,isOuter){
    this.x=x; this.y=y;
    this.vx=Math.cos(a)*s*(0.9+Math.random()*0.2);
    this.vy=Math.sin(a)*s*(0.9+Math.random()*0.2);
    this.life=180;
    this.color=c;
    this.len=Math.random()*26+22;
    this.isOuter=isOuter;
  }
  update(){
    this.x+=this.vx; this.y+=this.vy; this.vy+=0.02; this.life--;
    if(this.isOuter && Math.random()<0.07) sparks.push(new Spark(this.x-this.vx*this.len*0.5,this.y-this.vy*this.len*0.5,this.vx,this.vy,this.color));
    if(Math.random()<0.015) embers.push(new Ember(this.x,this.y));
  }
  draw(){
    const alpha = this.life/180;
    ctx.globalAlpha = alpha;
    const grad = ctx.createLinearGradient(this.x,this.y,this.x-this.vx*this.len,this.y-this.vy*this.len);
    grad.addColorStop(0,'white');
    grad.addColorStop(0.3,this.color);
    grad.addColorStop(1,'transparent');
    ctx.strokeStyle = grad;
    ctx.lineWidth = 2.5;
    ctx.beginPath();
    ctx.moveTo(this.x,this.y);
    ctx.lineTo(this.x - this.vx*this.len, this.y - this.vy*this.len);
    ctx.stroke();
    ctx.globalAlpha = 1;
  }
}

class Spark{constructor(x,y,vx,vy,c){const o=(Math.random()-0.5)*0.3;this.vx=vx*(0.35+Math.random()*0.25)-vy*o;this.vy=vy*(0.35+Math.random()*0.25)+vx*o;this.x=x;this.y=y;this.life=65;this.color=c;this.size=Math.random()*1.2+0.5;}update(){this.x+=this.vx;this.y+=this.vy;this.vy+=0.012;this.life--;}draw(){ctx.globalAlpha=this.life/65;ctx.fillStyle=this.color;ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fill();ctx.globalAlpha=1;}}
class Ember{constructor(x,y){this.x=x;this.y=y;this.life=40;this.size=Math.random()*2+1;}update(){this.life--;}draw(){ctx.globalAlpha=this.life/40;ctx.fillStyle='white';ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fill();ctx.globalAlpha=1;}}

/* ===== ФРАЗЫ ===== */
function maybeShowPhrase(x,y){
    if(Math.random()<0.85) return;
    const fonts=["Arial","Verdana","Tahoma","Georgia","Comic Sans MS","Impact","Courier New"];
    const d=document.createElement('div');
    d.className='phrase';
    d.textContent='АминаᰔᩚХадя';
    d.style.left=x+'px'; d.style.top=y+'px';
    d.style.color=`hsl(${Math.random()*360},100%,70%)`;
    d.style.fontFamily=fonts[Math.floor(Math.random()*fonts.length)];
    d.style.fontSize=(30+Math.random()*50)+'px';
    document.body.appendChild(d);
    setTimeout(()=>d.remove(),4000);
}

/* ===== ФОН ===== */
function drawBackground(){
  const grad=ctx.createRadialGradient(width/2,height/2,width*0.1,width/2,height/2,width);
  grad.addColorStop(0,'#0d1b2a');grad.addColorStop(1,'#000000');
  ctx.fillStyle=grad;ctx.fillRect(0,0,width,height);
}

/* ===== АНИМАЦИЯ ===== */
function animate(){
  drawBackground();
  drawStars();
  drawSnow();

  ctx.globalCompositeOperation='lighter';
  for(let i=rays.length-1;i>=0;i--){const r=rays[i]; r.update(); r.draw(); if(r.life<=0) rays.splice(i,1);}
  for(let i=sparks.length-1;i>=0;i--){const s=sparks[i]; s.update(); s.draw(); if(s.life<=0) sparks.splice(i,1);}
  for(let i=embers.length-1;i>=0;i--){const e=embers[i]; e.update(); e.draw(); if(e.life<=0) embers.splice(i,1);}
  ctx.globalCompositeOperation='source-over';

  requestAnimationFrame(animate);
}
animate();

/* ===== КЛИК / ТАЧ: САЛЮТ + ФРАЗА ===== */
let audioUnlocked=false;
function handleClick(x,y){
    if(!audioUnlocked){audioUnlocked=true; new Audio().play().catch(()=>{});}
    createFirework(x,y);
    maybeShowPhrase(x,y);
}
window.addEventListener('click', e=>handleClick(e.clientX,e.clientY));
window.addEventListener('touchstart', e=>{
  e.preventDefault();
  const touch = e.touches[0];
  handleClick(touch.clientX,touch.clientY);
}, {passive:false});

/* ===== СОЗДАНИЕ САЛЮТА ===== */
function createFirework(x,y){
  // Адаптация под маленький экран
  let count = width < 500 ? 120 : 220;
  for(let i=0;i<count;i++){
    const a = Math.PI*2*(i/count);
    const s = Math.random()*4.5+3.5;
    const hue = Math.random()*360;
    const c = `hsl(${hue},100%,65%)`;
    const outer = i > count*0.6;
    rays.push(new Ray(x,y,a,s,c,outer));
  }
  playSound();
}
</script>
</body>
</html>
